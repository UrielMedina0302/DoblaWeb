<div class="product-admin-container">
  <!-- Loading State -->
  <div *ngIf="isLoading && products.length === 0" class="loading-state">
    <div class="spinner"></div>
    <p>Cargando productos...</p>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="error-message alert alert-danger">
    {{ errorMessage }}
  </div>

  <!-- Product List -->
  <div class="product-grid">
    <div *ngFor="let product of products" class="product-card">
      <div class="product-image">
        <img [src]="product.images && product.images.length > 0 ? getFullImageUrl(product.images[0]) : 'assets/default-product.png'" 
             [alt]="product.name">
        <span class="status-badge" [class.active]="product.isActive">
          {{ product.isActive ? 'Activo' : 'Inactivo' }}
        </span>
      </div>
      <div class="product-info">
        <h3>{{ product.name }}</h3>
        <p>{{ product.description }}</p>
        <div class="product-actions">
          <button (click)="toggleProductStatus(product)" [class.btn-active]="product.isActive">
            {{ product.isActive ? 'Desactivar' : 'Activar' }}
          </button>
          <button (click)="openModal('edit', product._id)">Editar</button>
          <button (click)="deleteProduct(product._id)" class="btn-delete">Eliminar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Product Button -->
  <button (click)="openModal('add')" class="add-product-btn btn-primary">
    <i class="fas fa-plus"></i> Agregar Producto
  </button>

  <!-- Product Modal -->
  <div class="modal-overlay" *ngIf="showModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>{{ currentAction === 'add' ? 'Agregar Producto' : 'Editar Producto' }}</h3>
        <button (click)="closeModal()" class="close-btn">&times;</button>
      </div>
      <div class="modal-body">
        <!-- Formulario reactivo con ngSubmit -->
        <form [formGroup]="productForm" (ngSubmit)="submitForm()" #form="ngForm">
          <div class="form-group">
            <label for="name">Nombre*</label>
            <input 
              type="text" 
              id="name" 
              formControlName="name"
              [class.invalid]="productForm.get('name')?.invalid && productForm.get('name')?.touched">
            <small *ngIf="productForm.get('name')?.invalid && productForm.get('name')?.touched">
              Nombre requerido (3-100 caracteres)
            </small>
          </div>

          <div class="form-group">
            <label for="description">Descripción*</label>
            <textarea 
              id="description" 
              formControlName="description" 
              rows="3"
              [class.invalid]="productForm.get('description')?.invalid && productForm.get('description')?.touched"></textarea>
            <small *ngIf="productForm.get('description')?.invalid && productForm.get('description')?.touched">
              Descripción requerida (10-500 caracteres)
            </small>
          </div>

          <div class="form-group">
            <label for="images">Imágenes*</label>
            <input 
              type="file" 
              id="images"
              multiple 
              (change)="onFileSelected($event)" 
              accept="image/*"
              [class.invalid]="selectedFiles.length === 0 && form.submitted">
            <small>Máximo 5 imágenes (JPEG, PNG)</small>
            
            <div class="image-previews">
              <div *ngFor="let url of previewUrls; let i = index" class="image-preview">
                <img [src]="url" alt="Preview">
                <button type="button" (click)="removeImage(i)" class="remove-image-btn">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
            <small *ngIf="selectedFiles.length === 0 && form.submitted" class="error-text">
              Debes seleccionar al menos una imagen
            </small>
          </div>

          <div class="modal-footer">
            <button type="button" (click)="closeModal()" class="btn-cancel">Cancelar</button>
            <button 
              type="submit" 
              [disabled]="productForm.invalid || isLoading"
              class="btn-submit">
              {{ isLoading ? 'Procesando...' : (currentAction === 'add' ? 'Crear' : 'Actualizar') }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

